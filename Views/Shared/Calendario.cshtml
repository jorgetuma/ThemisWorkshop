@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Calendario";

    @using ThemisWorkshop.Controllers;

    @model List<Cita>
    
    List<String> dias = new List<String>();
    dias.Add("Domingo");
    dias.Add("Lunes");
    dias.Add("Martes");
    dias.Add("Miércoles");
    dias.Add("Jueves");
    dias.Add("Viernes");
    dias.Add("Sábado");
    string color;

    DateTime currentDate = DateTime.UtcNow.AddHours(-4);
    int year = currentDate.Year;
    int month = currentDate.Month;

    DateTime currentMonth = new DateTime(year, month, 1, currentDate.Hour, currentDate.Minute, currentDate.Second);
    int daysInMonth = DateTime.DaysInMonth(year, month);
    int startDay = (int)currentMonth.DayOfWeek;
    int emptyCells = startDay == 0 ? 6 : startDay - 1;
    int numRows = (int)Math.Ceiling((double)(daysInMonth + emptyCells) / 7);
}
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" ; charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <div class="row mt-3">
        <div class="col">
            <table class="table table-responsive  table-bordered" id="table">
                <tbody>
                    <tr class="text-center fw-bold">
                        @{
                            foreach (var dia in dias)
                            {
                                if (dia.Equals("Domingo") || dia.Equals("Sábado"))
                                {
                                    <td style="width: 2.5%; background-color: #FAFAFA;"></td>
                                }
                                else
                                {
                                    <td style="width: 19%;">@dia</td>
                                }
                            }
                        }
                    </tr>
                    @{
                        for (int row = 0; row < numRows; row++)
                        {
                            <tr>
                                @{
                                    for (int col = 0; col < 7; col++)
                                    {
                                        int dayNumber = row * 7 + col - emptyCells;
                                        string formattedDayNumber = dayNumber.ToString("D2");

                                        if (dayNumber > 0 && dayNumber <= daysInMonth)
                                        {
                                            DateTime currentDateOfMonth = new DateTime(year, month, dayNumber);
                                            var citasForDay = Model.Where(cita => cita.Fecha == currentDateOfMonth.Date).ToList();

                                            if (dayNumber == currentDate.Day)
                                            {
                                                color = "#E4ADC8";

                                                <td class="fw-bold border-3 hover-cell" style="border-color: @color;">
                                                    <div class="row">
                                                        <div class="col">
                                                            @{
                                                                foreach (var cita in citasForDay)
                                                                {
                                                                    <span class="badge" style="background-color: @color;">
                                                                        @cita.Asunto
                                                                    </span><br>
                                                                }
                                                            }
                                                        </div>
                                                        <div class="col-auto">
                                                            <small>@formattedDayNumber</small>
                                                        </div>
                                                    </div>
                                                </td>
                                            }
                                            else if (col == 0 || col == 6)
                                            {
                                                <td class="text-end" style="background-color: #FAFAFA;"><small class="grey">@formattedDayNumber</small></td>
                                            }
                                            else
                                            {
                                                <td class="hover-cell">
                                                    <div class="row">
                                                        <div class="col">
                                                            @{                                                                                                                  
                                                                foreach (var cita in citasForDay)
                                                                {
                                                                    DateTime citaDate = cita.Fecha.Date;

                                                                    if (citaDate < currentDate.Date)
                                                                    {
                                                                        color = "#FF6663";
                                                                    }
                                                                    else
                                                                    {
                                                                        color = "#B4D2E4";
                                                                    }
                                                                    <span class="badge" style="background-color: @color;">
                                                                        @cita.Asunto
                                                                    </span><br>
                                                                }
                                                            }
                                                        </div>
                                                        <div class="col-auto">
                                                            <small>@formattedDayNumber</small>
                                                        </div>
                                                    </div>
                                                </td>
                                            }
                                        }
                                        else
                                        {
                                            <td style="background-color: #FAFAFA;"></td>
                                        }
                                    }
                                }
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>